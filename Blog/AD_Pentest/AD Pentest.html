<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Directory Forest Pentest</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1, h2, h3 {
      color: #b30000;
    }

    h1 {
      font-size: 1.8rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    h2 {
      margin-top: 1.5rem;
      font-size: 1.2rem;
    }

    p {
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .highlight {
      background-color: #ffeaea;
      padding: 1rem;
      border-left: 5px solid #e60000;
      margin-bottom: 1rem;
    }

    .screenshot {
      display: block;
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      margin: 1rem 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    a {
      color: #0066cc;
    }

    footer {
      font-size: 0.9rem;
      text-align: center;
      border-top: 1px solid #ccc;
      margin-top: 2rem;
      padding-top: 1rem;
    }

    ul {
      margin-left: 1.5rem;
    }

    code {
      background: #eee;
      padding: 2px 5px;
      border-radius: 3px;
    }

    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #eee;font-size:14px}
    th{font-weight:600;color:#b30000}

    .muted{color:#666}
  </style>
</head>
<body>
  <div class="container">
    <h1>Active Directory Forest Pentest</h1>
    <p class="muted"><strong>Published:</strong> Sep 9, 2025 â€¢ <strong>Author:</strong> Devaraj Govindhan</p>

    <h2>1. Executive Summary</h2>
    <p>This assessment targeted the Active Directory (AD) forest within the <strong>172.25.170.0/24</strong> range, with exclusions at <strong>172.25.170.1</strong>. The goal was to identify Domain Controllers, enumerate users, and escalate privileges leveraging Kerberos-based attacks (Silver Ticket, Golden Ticket, Kerberoasting). Ultimately, administrator-level access was achieved and multiple user/admin flags were extracted from key hosts.</p>

    <h2>2. Scope</h2>
    <ul>
      <li><strong>In-Scope:</strong> 172.25.170.0/24</li>
      <li><strong>Exclusion:</strong> 172.25.170.1</li>
    </ul>

    <h2>3. Attack Timeline</h2>
    <table>
      <thead><tr><th>Step</th><th>Activity</th></tr></thead>
      <tbody>
        <tr><td>Recon</td><td>SMB brute force identified valid credentials for <code>cpent:XXX</code> on <strong>172.25.170.110</strong>.</td></tr>
        <tr><td>Discovery</td><td>Full subnet scan revealed potential Domain Controllers at <strong>172.25.170.80</strong> and <strong>172.25.170.190</strong>.</td></tr>
        <tr><td>Enumeration</td><td>Verified domain login via <code>crackmapexec</code> and extracted AD users with <code>GetADUsers</code>.</td></tr>
        <tr><td>Password Spray</td><td>Pattern-based spraying confirmed that the Administrator account shared the same password.</td></tr>
        <tr><td>Privilege Escalation</td><td>Dumped <code>NTDS.dit</code> via <code>impacket-secretsdump</code>, recovering domain hashes and Kerberos keys.</td></tr>
        <tr><td>Access</td><td>SMB access confirmed with Administrator hash, enabling retrieval of sensitive flags from both DC and member hosts.</td></tr>
      </tbody>
    </table>

    <h2>4. Technical Analysis</h2>
    <h3>4.1 Initial Access</h3>
    <p>Access was achieved through SMB brute forcing against <strong>172.25.170.110</strong>, yielding valid credentials for:</p>
    <div class="highlight">
      User: <strong>cpent</strong><br>
      Pass: <strong>XXX</strong>
    </div>
    <img src="smb_bruteforce.png" alt="SMB Brute Force / Credentials" class="screenshot">

    <h3>4.2 Domain Controller Identification</h3>
    <p><code>nmap -A 172.25.170.0/24</code> identified Kerberos (88/tcp) and LDAP (389/tcp) services on the following:</p>
    <ul>
      <li>DC1: <strong>172.25.170.80</strong></li>
      <li>DC2: <strong>172.25.170.190</strong></li>
    </ul>
    <img src="nmap_scan_80.png" alt="Nmap Scan for DCs" class="screenshot">
    <img src="nmap_scan_190.png" alt="Nmap Scan for DCs" class="screenshot">

    <h3>4.2 Verify Domain Login & User Enumeration</h3>
    <p>To confirm domain access, LDAP/SMB authentication was tested against the Domain Controller:</p>
    <pre><code>crackmapexec smb 172.25.170.80 -u cpent -p 'XXX' --shares</code></pre>
    <img src="getadusersshare.png" alt="GetADUsersShares Output" class="screenshot">
    <p>This step verified that <strong>cpent</strong> could authenticate against the DC and allowed enumeration of all domain users.</p>
    <pre><code>impacket-GetADUsers ECC.LOCALNET/cpent -dc-ip 172.25.170.80 -all</code></pre>
    <img src="getadusers.png" alt="GetADUsers Output" class="screenshot">

    <h3>4.3 Credential Reuse & Spraying</h3>
    <p>With one known working password, spraying against AD accounts revealed Administrator reused the same credential.</p>
    <div class="highlight">
      User: <strong>Administrator</strong><br>
      Pass: <strong>XXX</strong>
    </div>
    <img src="password_spray.png" alt="CrackMapExec Password Spray Results" class="screenshot">

    <h3>4.4 Secrets Dump</h3>
    <p>Domain hashes and Kerberos keys were dumped via <code>impacket-secretsdump</code> from DC:</p>
    <ul>
      <li>Administrator NTLM: <code>52838ab3f0_XXX_080b52043d2cb0f</code></li>
      <li>krbtgt NTLM: <code>276e4020f8a27_XXX_0636764</code></li>
      <li>Other users (cpent, Preston, test.user, LPT) had identical hash values.</li>
    </ul>
    <img src="secretsdump.png" alt="Secretsdump Output" class="screenshot">

    <h2>5. Flags Captured</h2>
    <table>
      <thead><tr><th>Host</th><th>Flag</th><th>Screenshot</th></tr></thead>
      <tbody>
        <tr>
          <td>DC (172.25.170.80)</td>
          <td><code>WS_XXX_-USER</code></td>
          <td><img src="dc_admin_flag.png" alt="DC Admin Flag" class="screenshot"></td>
        </tr>
        <tr>
          <td>172.25.170.110 (User)</td>
          <td><code>WS_XXX_USER</code></td>
          <td><img src="user_flag.png" alt="User Flag" class="screenshot"></td>
        </tr>
        <tr>
          <td>172.25.170.110 (Admin)</td>
          <td><code>ouble_XXX_nFLAGTWO</code></td>
          <td><img src="admin_flag.png" alt="Admin Flag" class="screenshot"></td>
        </tr>
      </tbody>
    </table>

    <h2>6. Lessons Learned</h2>
    <ul>
      <li><strong>Password Reuse:</strong> Multiple AD accounts (including Administrator) used the same weak password, enabling lateral movement.</li>
      <li><strong>Kerberos Key Exposure:</strong> Dumped keys enabled potential Golden/Silver ticket attacks.</li>
      <li><strong>Service Misconfigurations:</strong> Remote registry access facilitated <code>NTDS.dit</code> extraction.</li>
    </ul>

    <h2>7. Recommendations</h2>
    <ul>
      <li>Enforce unique, complex passwords for all AD accounts.</li>
      <li>Enable monitoring/detection for SMB brute-force attempts and password spraying.</li>
      <li>Harden Domain Controllers: restrict remote registry, SMB shares, and enforce least-privilege.</li>
      <li>Rotate and monitor Kerberos tickets, especially <code>krbtgt</code>, to prevent persistence via Golden Ticket attacks.</li>
    </ul>

    <h2>8. Conclusion</h2>
    <p>The engagement successfully demonstrated compromise of both Domain Controllers and member hosts within the AD forest. Weak password practices and lack of monitoring allowed escalation from a low-privileged local user to full domain administrator, enabling sensitive data extraction and persistent access opportunities. Strengthening password policies, reducing service exposure, and improving monitoring would significantly reduce attack surface.</p>

    <footer>
      <div class="muted">This summary captures technical findings from the AD pentest in the 172.25.170.0/24 environment. Replace the <code>src</code> attributes with actual screenshot file paths for final report rendering.</div>
    </footer>
  </div>
</body>
</html>

