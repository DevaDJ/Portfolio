<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NailaoLocker Ransomware ‚Äì Technical Analysis</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1, h2, h3 {
      color: #003366;
    }

    h1 {
      font-size: 2rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    h2 {
      margin-top: 2rem;
      font-size: 1.4rem;
    }

    p {
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    code, pre {
      background-color: #f2f2f2;
      padding: 0.5rem;
      display: block;
      margin: 1rem 0;
      border-left: 4px solid #003366;
      white-space: pre-wrap;
    }

    .highlight {
      background-color: #e8f0fe;
      padding: 1rem;
      border-left: 5px solid #0073e6;
      margin-bottom: 1rem;
    }

    ul {
      margin-left: 1.5rem;
    }

    a {
      color: #0066cc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
    }

    th {
      background-color: #003366;
      color: white;
    }

    footer {
      font-size: 0.9rem;
      text-align: center;
      border-top: 1px solid #ccc;
      margin-top: 2rem;
      padding-top: 1rem;
    }

    img {
      width: 100%;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê NailaoLocker Ransomware ‚Äì Technical Analysis</h1>

    <p>
      NailaoLocker is a ransomware family written in C++, attributed to the Chinese-linked APT cluster "Green Nailao", and is known for overlaps with ShadowPad and PlugX. The malware uses DLL side-loading and implements AES-256-CBC encryption with SM2 public key wrapping, primarily targeting healthcare entities in Europe.
    </p>

    <h2>üß© Malware Overview</h2>
    <ul>
      <li><strong>Name:</strong> NailaoLocker</li>
      <li><strong>Language:</strong> C++</li>
      <li><strong>Delivery:</strong> DLL Side-loading</li>
      <li><strong>Encryption:</strong> AES‚Äë256‚ÄëCBC + SM2-wrapped AES keys</li>
      <li><strong>Extension:</strong> .locked</li>
      <li><strong>Note:</strong> Ransom note extracted via XOR</li>
      <li><strong>Discovery:</strong> June 2024 (full analysis Feb 2025)</li>
    </ul>

    <h2>‚öôÔ∏è Infection & Execution Flow</h2>
    <img src="asset/NailaoLocker.png" alt="Execution Flow" style="max-width:80%; height:auto; display:block; margin: 1rem auto;" />
    <ol>
      <li>Exploits CVE‚Äë2024‚Äë24919 in Check Point VPN appliances</li>
      <li>Deploys:
        <ul>
          <li>usysdiag.exe (host executable)</li>
          <li>sensapi.dll (malicious loader)</li>
          <li>usysdiag.exe.dat (payload)</li>
        </ul>
      </li>
      <li>Creates mutex Global\lockv7, deletes loader for stealth</li>
      <li>Starts IOCP threads for concurrent encryption</li>
      <li>Encrypts using AES-256-CBC per file and appends .locked</li>
      <li>Appends "LV7" metadata footer with SM2-wrapped AES keys</li>
      <li>Ransom note decoded and displayed via console + lock.log</li>
    </ol>

    <h2>üîç Static Analysis Highlights</h2>
    <ul>
      <li>Payload XOR-decrypted and injected into memory</li>
      <li>Console shows live encryption stats</li>
      <li>Private SM2 key embedded, but decryption fails</li>
      <li>Hardcoded mode flag ("lockv7") determines encrypt/decrypt behavior</li>
    </ul>

    <h2>üíª Dynamic Behavior</h2>
    <ul>
      <li>Uses IOCP threading to maximize encryption throughput</li>
      <li>Skips system files and folders</li>
      <li>Console window logs encryption progress</li>
      <li>Deletes loader files post-deployment</li>
    </ul>

    <h2>üìÅ Indicators of Compromise (IOCs)</h2>
    <div class="highlight">
      <strong>Mutex:</strong> Global\lockv7<br />
      <strong>Log File:</strong> %ProgramData%\lock.log<br />
      <strong>Extension:</strong> .locked<br />
      <strong>Footer Identifier:</strong> "LV7"
    </div>

    <h3>üîë SHA256 Hashes</h3>
    <pre>
1248c4b352b9b1325ef97435bd38b2f02d21e2c6d494a2218ee363d9874b7607
46f3029fcc7e2a12253c0cc65e5c58b5f1296df1e364878b178027ab26562d68
60133376a7c8e051da787187761e596ce9b3d0cfcea21ed8f434992aa7cb8605
27b313243daf145c9105f5372e01f1cea74c62697195c1a21c660be5f7ee788c
2b069dcde43b874441f66d8888dcf6c24b451d648c8c265dffb81c7dffafd667
7a0503da293da51a95aab0b1aa0970c8f82f04cb5149abe98fef934ba991064e
a2e937d0b9d5afa5b638cd511807e0fcb44ec81b354e2cf0c406f19e5564e54e
    </pre>

    <h2>üß† MITRE ATT&CK Mapping</h2>
    <ul>
      <li><strong>Initial Access:</strong> T1190 ‚Äì Exploit Public-Facing Application</li>
      <li><strong>Execution:</strong> T1574.002 ‚Äì DLL Side-loading</li>
      <li><strong>Persistence:</strong> T1053.005 ‚Äì Scheduled Task / WMI</li>
      <li><strong>Defense Evasion:</strong> T1070.004 ‚Äì File Deletion</li>
      <li><strong>Impact:</strong> T1486 ‚Äì Data Encrypted for Impact</li>
      <li><strong>Ransom Note:</strong> T1491.001 ‚Äì Internal Defacement</li>
    </ul>

    <h2>üõ°Ô∏è Mitigation & Recommendations</h2>
    <ul>
      <li>Apply VPN patches (CVE‚Äë2024‚Äë24919 mitigation)</li>
      <li>Alert on Global\lockv7 and file extension ".locked"</li>
      <li>Block DLL side-loading attempts (sensapi.dll misuse)</li>
      <li>Monitor WMI traffic and log deletion activity</li>
      <li>Ensure backups are offline and immutable</li>
      <li>Use YARA/Sigma rules for XOR decryption and "LV7" signature</li>
    </ul>

    <h2>üì£ Final Thoughts</h2>
    <p>
      NailaoLocker represents a hybrid between espionage tooling and ransomware. Although technically flawed due to its broken decryption logic, its multithreaded encryption, embedded SM2 cryptography, and use of side-loaded loaders reflect APT sophistication. Detection hinges on recognizing behavioral signals like mutex creation, AES-based encryption, and metadata markers.
    </p>

    <footer>
      üîê Stay updated. Patch proactively. Hunt intelligently.<br />
      &copy; 2025 Cyberkiller's Blog
    </footer>
  </div>
</body>
</html>

